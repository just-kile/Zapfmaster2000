<!DOCTYPE html>
<html>
<head>
<!-- Meta Tags for mobile -->
   <meta charset="utf-8">
<meta name="apple-mobile-web-app-capable" content="yes" />
<meta name="apple-mobile-web-app-status-bar-style" content="black" />  
 <meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta http-equiv="X-UA-Compatible" content="IE=edge">

 <script src="../libs/jquery/jquery-1.8.1.js"></script> 
  <script src="../libs/bootstrap/js/bootstrap.min.js"></script> 
  <script src="../libs/ICanHaz.min.js"></script> 
  
 <link rel="stylesheet" type="text/css" href="../libs/bootstrap/css/bootstrap.min.css" />
 
 <link rel="stylesheet" type="text/css" href="../libs/bootstrap/css/bootstrap-responsive.min.css" />

 <link rel="stylesheet" type="text/css" href="css/style.css" />
 <script>
 var baseUrl = "../";
 </script>
<script id="dashboard-calibration" type="text/html">
<div class="navbar box">
  <div class="navbar-inner">
<form class="form-horizontal" action="../rest/calibration/boxes/old/{{boxId}}" data-boxid="{{boxId}}">
<fieldset>	

	<legend class="brand">Zapfkit Id: {{boxId}}</legend>
   <div class="control-group">
	    <label class="control-label" for="regression_{{boxId}}">Regression</label>
		 <div class="controls">
			<input class="registerItem" id="regression_{{boxId}}" name="regression" type="number" placeholder="Regression" value="{{regression}}" step="0.00001">
			<a href="#" class="tt" data-toggle="tooltip" data-placement="right" title="" data-original-title="{{regressionTT}}"><i class="icon-question-sign"></i></a>
		</div>
	</div>
	<div class="control-group">
		<label class="control-label" for="disturbance_{{boxId}}">Störung</label>
		<div class="controls">
			<input class="registerItem" id="disturbance_{{boxId}}" name="disturbance" type="number" placeholder="Disturbance" value="{{disturbance}}" step="1">
			<a href="#" class="tt" data-toggle="tooltip" data-placement="right" title="" data-original-title="{{disturbanceTT}}"><i class="icon-question-sign"></i></a>
		</div>
	</div>
	<div class="control-group">
		<label class="control-label" for="tickReduction_{{boxId}}">Tick Reduktion</label>
		<div class="controls">
			<input class="registerItem" id="tickReduction_{{boxId}}" name="tickReduction" type="number" placeholder="tickReduction" value="{{tickReduction}}" step="1">
			<a href="#" class="tt" data-toggle="tooltip" data-placement="right" title="" data-original-title="{{tickReductionTT}}"><i class="icon-question-sign"></i></a>
		</div>
	</div>
	<div class="control-group">
		<div class="controls">
			<input id ="newKegBtn" type="submit" value="Ändern" class="btn btn-primary" style="display:block">
		</div>
	</div>
	
</fieldset>
</form>
</div>
</div></script>

</head>
<body>
<!-- Include Navigation -->
<div id="navigation"></div>
<script>
var navigation = $("#navigation").load("header.html",function(){
	navigation.find(".calibration").addClass("active");	
});
</script>
<script type="text/javascript">
var toolTips= {
		regressionTT:"Die Regression und die Störung sind die beiden Koeffizienten zur linearen Regression um die tatsächliche Menge aus den Ticks zu ermitteln. Ticks wurden dabei schon reduziert. <br/>Formel:  Menge = Regression * total_ticks + Störung.",
		disturbanceTT:"Die Regression und die Störung sind die beiden Koeffizienten zur linearen Regression um die tatsächliche Menge aus den Ticks zu ermitteln. Ticks wurden dabei schon reduziert. <br/>Formel:  Menge = Regression * total_ticks + Störung.",
		tickReductionTT:'Der Wert "Tick Reduktion" wird von JEDEM Tick Request vom Zapfkit zum Backend subtrahiert. Je höher dieser Wert ist, desto niedriger ist der Zapf-Mengenwert, der in die Datenbank geschrieben wird.',
}
function refreshData(){
	var data = {};
	data["token"] = localStorage.getItem("token");
	$.ajax({
		type:"GET",
		url:"../rest/calibration/boxes",
		data:data,
		error:function(){
			alert("Error retrieving boxes!");
		},
		success: function(boxArr){
		// DEBUG DATAS
		/*	boxArr = [{
				boxId:1,
				regression:Math.random(),
				disturbance:Math.random(),
				tickReduction:5
			},{
				boxId:2,
				regression:Math.random(),
				disturbance:Math.random(),
				tickReduction:90
			}];*/
			var container = $(".mainContainer");container.find(".box").remove();
			$.each(boxArr,function(ind,boxData){
				$.extend(boxData,toolTips);
				var template =ich["dashboard-calibration"](boxData);
				container.append(template);
				
			});
			container.find(".tt").tooltip({
				html:true
			});
		}
	})
	

	

}
$(function(){

	refreshData();
	
	$("#refreshBoxBtn").on("click",function(){
		refreshData();
	});
	$(".mainContainer").on("submit","form",function(e){
		e.preventDefault();
		var form = $(e.currentTarget);
		var boxId=form.data("boxid");
		
		var data = {
				regression:form.find("#regression_"+boxId).val(),
				disturbance:form.find("#disturbance_"+boxId).val(),
				tickReduction:form.find("#tickReduction_"+boxId).val(),
				
		};
		data["token"] = localStorage.getItem("token");
		$.ajax({
			type:"POST",
			url:form.attr("action"),
			data:data,
			success:function(){
				alert("Daten geändert!");
			},
			error:function(){
				alert("Daten ändern fehlgeschlagen!");
			}
		})
	});
});

</script>
<!-- Main Container -->

<div class="container mainContainer" style="margin-top:50px">
	<div class="btn btn-success" id="refreshBoxBtn" style="margin-bottom:20px">Aktualisiere Zapfkits<i class="icon-refresh icon-white"></i></div>

</div>

</body>
</html>